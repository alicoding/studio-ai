#!/usr/bin/env sh

# Auto-rebuild semantic index after commits
echo "ğŸ”„ Checking if semantic index needs rebuild..."

# Check if any source files changed in the last commit
CHANGED_FILES=$(git diff-tree --no-commit-id --name-only -r HEAD | grep -E 'src/.*\.(ts|js|tsx|jsx)$' || true)

if [ -n "$CHANGED_FILES" ]; then
    echo "ğŸ“ Source files changed, rebuilding semantic index..."
    # Run in background to not block git operations
    (npm run build-semantic-index --silent || echo "âš ï¸  Semantic index build failed") &
    echo "âœ… Semantic index update started in background"
else
    echo "â„¹ï¸  No source changes, skipping semantic index rebuild"
fi