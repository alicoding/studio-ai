#!/usr/bin/env sh

# Auto-rebuild semantic index after merging branches
echo "🔄 Checking if semantic index needs rebuild after merge..."

# Check if any source files changed
CHANGED_FILES=$(git diff --name-only HEAD@{1} HEAD | grep -E 'src/.*\.(ts|js|tsx|jsx)$' || true)

if [ -n "$CHANGED_FILES" ]; then
    echo "📝 Source files changed during merge, rebuilding semantic index..."
    npm run build-semantic-index --silent || echo "⚠️  Semantic index build failed"
    echo "✅ Semantic index update complete"
else
    echo "ℹ️  No source changes in merge, skipping semantic index rebuild"
fi